id: meta-tab
type: PageSiderMenu
properties:
  title: List Blocks
  logo:
        src: https://i.postimg.cc/Qtn1P5zW/simbiose-Logo.png
        style:
          width: 10px;
          margin: 10px 15px;
          height: 100px;
requests:
  # MongoDb Aggregation to get the product data.
  - id: all_tabs
    type: MongoDBAggregation 
    connectionId: meta-tab # Id of the connection defined in the lowdefy.yaml file.
    properties:
      pipeline: # Here we can simply provide any valid MongoDB aggregation pipeline, like do a very basic sort.
        - $sort:
            _id: 1
  - id: update_tabs
    type: MongoDBUpdateOne # MongoDb updateOne request to update the selected product
    connectionId: meta-tab
    properties:
      filter:
        _id:
          _state: edit_tab._id # Filter the document that matches the selected document's _id (which is nested in the edit_product object)
      update:
        $set:
          name:
            _state: edit_tab.name
          brand_id:
            _state: edit_tab.brand_id
          description:
            _state: edit_tab.description
          updated_at:
            _date: now

events:
  onEnter:
    # Fetch the all_tabs request every time when a user enters the page.
    - id: fetch_tabs  
      type: Request
      params: all_tabs
    - id: set_tabs
      type: SetState
      params:
        tab_list:
          _request: all_tabs  
   
layout:
  contentJustify: center
  contentGutter: 16
  size: 500
areas:
  content:
    blocks:
      - id: tab_list
        type: List
        blocks:
          - id: tab_list.$.container # Wrap all the blocks for a brand item in a box.
            type: Box
            style:
              background: '#fff' # Give the box a white background and some spacing.
              margin: 10
              padding: 10
            blocks:
              # - id: tab_list.$.tab.tabId
              #   type: TextInput
              #   layout:
              #     span: 12
              #   required: true
              #   properties:
              #     title: Tab Id
              #     label:
              #       span: 10
              #       align: right
              - id: tab_list.$.tab.name
                type: Title
                properties:
                  content: 
                    _state: tab_list.$.tab.name
                  level: 4
            events:
              onClick:
                - id: set_edit_tab
                  type: SetState
                  params:
                    edit_tab: 
                      _state: tab_list.$.tab
                - id: open_edit_tab # Open the drawer which contains the input fields to edit the selected product.
                  type: CallMethod
                  params:
                    blockId: edit_tab_drawer
                    method: toggleOpen

      - id: edit_tab_drawer
        type: Drawer
        properties:
          title: Edit Tab
          width: 1024
        layout:
          contentGutter: 16
        blocks:
          - id: edit_tab.tabId # A text input block to edit the product name.
            type: TextInput
            layout:
              span: 12
              # align: left
            required: true
            properties:
              title: Tab Id
              placeholder: Tab Id
              disabled: true
              label:
                span: 10
                align: center
          - id: edit_tab.name # A text input block to edit the product name.
            type: TextInput
            layout:
              span: 12
            required: true
            properties:
              title: Name
              placeholder: Tab Name
              label:
                span: 10
                align: center
          - id: edit_tab.SubTabsCard
            type: Card
            properties:
              title: Sub Tabs
            layout:
              span: 26
            blocks:
            - id: edit_tab.subTabs
              type: ControlledList
              blocks:
                # - id: edit_tab.subTabs.$
                #   type: TitleInput
                #   properties:
                #     level: 1
                - id: edit_tab.subTabs.$.name
                  type: TextInput
                  layout:
                    span: 12
                  required: true
                  properties:
                    title: First Name
                    label:
                      span: 10
                      align: right                                    
                - id: edit_tab.subTabs.$.url
                  type: TextInput
                  layout:
                    span: 12
                  required: true
                  properties:
                    title: First Name
                    label:
                      span: 10
                      align: right
                - id: edit_tab.subTabs.$.last_name
                  type: TextInput
                  layout:
                    span: 12
                  required: true
                  properties:
                    title: Last Name
                    label:
                      span: 10
                      align: right
                # - id: edit_tab.subTabs.$.date_of_birth
                #   type: DateSelector
                #   layout:
                #     span: 12
                #   required: true
                #   properties:
                #     title: Date of Birth
                #     label:
                #       span: 10
                #       align: right
                # - id: edit_tab.subTabs.$.email
                #   type: TextInput
                #   layout:
                #     span: 12
                #   required: true
                #   properties:
                #     title: Email address
                #     label:
                #       span: 10
                #       align: right
                # - id: edit_tab.subTabs.$.phone_number
                  # type: TextInput
                  # layout:
                  #   span: 12
                  # properties:
                  #   title: Phone number
                  #   label:
                  #     span: 10
                  #     align: right
                - id: edit_tab.subTabs.$.preference
                  type: ButtonSelector
                  layout:
                    span: 12
                  properties:
                    title: Preference
                    label:
                      span: 10
                      align: right
                    options:
                      - Phone
                      - Email             
                - id: edit_tab.SubTabsCard.Object
                  type: Card
                  properties:
                    title: Sub Object
                  layout:
                    span: 26
                  blocks:
                    - id: edit_tab.subTabs.$.object.name
                      type: TextInput
                      layout:
                        span: 12
                      required: true
                      properties:
                        title: Object Name
                        label:
                          span: 10
                          align: right 
                    - id: edit_tab.subTabs.$.object.url
                      type: TextInput
                      layout:
                        span: 12
                      required: true
                      properties:
                        title: Object Url
                        label:
                          span: 10
                          align: right                          
                - id: edit_tab.SubTabsCard.ListCard  
                  type: Card
                  properties:
                    title: Sub Lists
                  layout:
                    span: 26
                  blocks:
                  - id: edit_tab.subTabs.list
                    type: ControlledList
                    blocks:
                      - id: edit_tab.subTabs.$.list.$.name
                        type: TextInput
                        layout:
                          span: 12
                        required: true
                        properties:
                          title: First Name
                          label:
                            span: 10
                            align: right  
                      - id: edit_tab.subTabs.$.list.$.url
                        type: TextInput
                        layout:
                          span: 12
                        required: true
                        properties:
                          title: Url
                          label:
                            span: 10
                            align: right 
          - id: update_product_button
            type: Button
            layout:
              grow: 3 # Make the update button 3 times the width of the delete button in the display css flex row
            properties:
              title: Save
              icon: SaveOutlined
              block: true
            events:
              onClick:
                - id: update_tab # Call the update_product request to save the product changes.
                  type: Request
                  params: update_tab
                - id: fetch_all_tabs # Refresh the all_products request to get the latest product details from the database.
                  type: Request
                  params: all_tabs
                - id: set_tabs # Update the product_list array in state so that the page shows the latest product data.
                  type: SetState
                  params:
                    tab_list:
                      _request: all_tabs
                - id: close_drawer # Close the edit_product drawer.
                  type: CallMethod
                  params:
                    blockId: edit_tab_drawer
                    method: toggleOpen                    